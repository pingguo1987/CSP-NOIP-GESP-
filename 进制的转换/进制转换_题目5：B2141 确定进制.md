## 题目5：B2141 确定进制

[B2141 确定进制](https://www.luogu.com.cn/problem/B2141)

本题是R进制转成十进制的变形题。

**同类题目**



### 前置知识

- 无

**题目描述**

$6\ \times 9=42$ 对于十进制来说是错误的，但是对于 $13$ 进制来说是正确的。即 $6_{(13)}\ \times 9_{(13)}=42_{(13)}$，而 $42_{(13)}=4\ \times 13^1+2\ \times 13^0=54_{(10)}$。

你的任务是写一段程序读入三个整数 $p,q$ 和 $r$，然后确定一个进制 $B(2 \le B \le 16)$ 使得 $p\ \times q=r$。如果 $B$ 有很多选择，则输出最小的一个。

例如：$p=11,q=11,r=121$，则有 $11_{(3)}\ \times 11_{(3)}=121_{(3)}$，因为 $11_{(3)}=1\ \times 3^1+1\ \times 3^0=4_{(10)}$ 和 $121_{(3)}=1\ \times 3^2+2\ \times 3^1+1\ \times 3^0=16_{(10)}$。对于进制 $10,$ 有 $11_{(10)}\ \times 11_{(10)}=121_{(10)}$。这种情况下，应该输出 $3$。如果没有合适的进制，则输出 $0$。

**输入格式**

一行，包含三个整数 $p,q,r$，相邻两个整数之间用单个空格隔开。

**输出格式**

一个整数：即使得 $p \times q=r$ 成立的最小的 $B$。如果没有合适的 $B$，则输出 $0$。

**样例输入 #1**

```
6 9 42
```

**样例输出 #1**

```
13
```

**提示**

$p,q,r$ 的所有位都是数字，并且 $1 \le p,q,r \le 10^6$。

**思路分析**

**转换规则：**把R进制数按权展开后，结果相加即是十进制数。 

以**二进制转十进制**为例

从低位到高位（即从右往左）计算，第0位的权值是2的0次方，第1位的权值是2的1次方，第2位的权值是2的2次方，依次计算到最高位，把结果相加即可。

例如：二进制数`11101` 转换为十进制为`29`。
$$
1 \times 2^0 + 0 \times 2^1 + 1 \times 2^2 + 1 \times 2^3 + 1 \times 2^4 = 29
$$
此题中需要注意乘法的越界以及不合法的进制的剪枝。

**程序代码**

```c++
//https://www.luogu.com.cn/problem/B2141
//B2141 确定进制
#include<iostream>
#include<cmath>
using namespace std;

long long ktod(string s,int x)
{
    long long sum = 0;
    for(int i=0;i<s.size();i++)
    {
        if(s[i] >= x)
        if(s[i]>='0' && s[i]<='9')
        {
            // 数位大于等于进制了，肯定不合法，比如2进制数：113，2进制不可能出现大于等于2的数字
            if((s[i]-'0') >= x)
            {
                return -1;
            }
            // 如果是数字，则减'0' 后转换为数字
            sum += (s[i]-'0') * pow(x,s.size()-i-1);
        }else
        {
            if((s[i]-'A' + 10) >= x)
            {
                return -1;    
            }
            // 如果是A-Z 则需要减'A'+10 转换为数字
            sum += (s[i]-'A' + 10) * pow(x,s.size()-i-1);
        }          
    }
    return sum;
}

// 将不同的进制转成十进制，然后计算乘法，和结果进行比较是否相同
int main()
{
    
    string p,q,r;
    cin>>p>>q>>r;
    
    // 对每一种进制都尝试计算，看看是否能够相等
    for(int k=2;k<=16;k++)
    {
        // 转换成k进制，并在转换的时候判断是否合法，如果不合法直接跳过
        long long num1 = ktod(p,k);
        if(num1 == -1)
        {
            continue;
        }
        long long num2 = ktod(q,k);
        if(num2 == -1)
        {
            continue;
        }
        long long num3 = ktod(r,k);
        if(num3 == -1)
        {
            continue;
        }
        if(num1*num2 == num3)
        {
            cout<<k<<endl;
            return 0;
        }
    }
    // 不符合要求输出0
    cout<<0<<endl;
    return 0;
}
```



**题目感悟**

本题对我来说最重要一个收获就是进制求和时，如何将字符转成可以运算的数字并将计算后的结果转成字符。

---

欢迎关注我的公众号**wangsir 聊信息学**，原创技术文章第一时间推送。

<center>
    <img src="https://cdn.jsdelivr.net/gh/pingguo1987/CSP-NOIP-GESP-/image/pic/公众号-扫码版.png">
</center>
